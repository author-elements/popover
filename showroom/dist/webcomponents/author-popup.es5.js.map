{"version":3,"file":"author-popup.es5.js","sources":["../src/element.js"],"sourcesContent":["class AuthorPopupElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineProperties({\n      annotatedElement: {\n        private: true,\n        readonly: true,\n        get: () => document.getElementById(this.getAttribute('for')) || null\n      },\n\n      hidden: {\n        private: true,\n        default: true\n      },\n\n      position: {\n        private: true,\n        default: ['left', 'bottom']\n      },\n\n      validPositions: {\n        readonly: true,\n        private: true,\n        default: ['left', 'center', 'right', 'top', 'bottom']\n      },\n\n      validModes: {\n        private: true,\n        readonly: true,\n        default: ['hover', 'click', 'programmatic']\n      }\n    })\n\n    this.UTIL.defineAttributes({\n      mode: 'programmatic',\n\n      // position: {\n      //   default: 'center top',\n      //\n      //   get: () => this.PRIVATE.position ? this.PRIVATE.position.join(' ') : null,\n      //\n      //   set: value => {\n      //     if (Array.isArray(value)) {\n      //       return\n      //     }\n      //\n      //     let input = value.split(' ').map(term => {\n      //       let isValid = this.PRIVATE.validPositions.includes(term.trim())\n      //\n      //       if (!isValid) {\n      //         return this.UTIL.printToConsole(`Invalid position \"${term}\". Valid position values: \"${this.PRIVATE.validPositions.join('\", \"')}\"`, 'error')\n      //       }\n      //\n      //       return term.trim()\n      //     }).filter(Boolean)\n      //\n      //     this.PRIVATE.position = this.PRIVATE.validPositions.filter(term => input.includes(term))\n      //     this.PRIVATE.reposition()\n      //   }\n      // }\n    })\n\n    this.UTIL.definePrivateMethods({\n      annotatedElementEnterHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.show()\n      },\n\n      annotatedElementLeaveHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.hide()\n      },\n\n      pointerenterHandler: evt => {\n        this.on('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.UTIL.setStyleProperty('visibilityRule', )\n\n        this.emit({\n          name: 'annotated-element.enter',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      pointerleaveHandler: evt => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.on('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.emit({\n          name: 'annotated-element.leave',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      applyHoverListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.addEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      removeHoverListeners: () => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.removeEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      applyClickListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      removeClickListeners: () => {\n        document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      clickHandler: evt => {\n        evt.stopPropagation()\n        this.hidden ? this.show() : this.hide()\n      },\n\n      documentClickHandler: evt => {\n        if (evt.target === this || this.contains(evt.target)) {\n          return\n        }\n\n        this.hide()\n      },\n\n      // reposition: evt => {\n      //   let { annotatedElement, position } = this.PRIVATE\n      //   // let reference = this.PRIVATE.annotatedElement.getBoundingClientRect()\n      //\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //\n      //   this.UTIL.removeStyleProperties('positionRule', ['top', 'right', 'bottom', 'left', 'transform'])\n      //\n      //   switch (position[0]) {\n      //     case 'right': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetRight}px`)\n      //     case 'center': return this.UTIL.setStyleProperty('positionRule', 'left', `${(reference.left + reference.width / 2) - (this.clientWidth / 2)}`)\n      //     case 'left': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetLeft - this.clientWidth}px`)\n      //   }\n      //\n      //   // switch (position[1]) {\n      //   //   case 'top': return this.UTIL.setStyleProperty('positionRule', 'bottom', `${reference.top}px`)\n      //   //   case 'center': return this.UTIL.setStyleProperty('positionRule', 'top', `${(reference.top + reference.height / 2) - (this.clientHeight / 2)}`)\n      //   //   case 'bottom': return this.UTIL.setStyleProperty('positionRule', 'top', `${reference.bottom}px`)\n      //   // }\n      // }\n    })\n\n    this.UTIL.registerListeners(this, {\n      'attribute.change': evt => {\n        let { attribute, oldValue, newValue } = evt.detail\n\n        if (newValue === oldValue) {\n          return\n        }\n\n        switch (attribute) {\n          case 'mode':\n            this.hide()\n            this.PRIVATE.removeHoverListeners()\n            this.PRIVATE.removeClickListeners()\n\n            switch (newValue) {\n              case 'hover': return this.PRIVATE.applyHoverListeners()\n              case 'click': return this.PRIVATE.applyClickListeners()\n              default: this.UTIL.throwError({\n                message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n              })\n            }\n\n            break\n\n          // case 'position':\n          //   this.position = newValue\n          //   break\n        }\n      },\n\n      connected: () => {\n        this.UTIL.insertStyleRules({\n          positionRule: ':host {}',\n          visibilityRule: ':host {}'\n        })\n\n        this.hide()\n\n        switch (this.mode) {\n          case 'hover': return this.PRIVATE.applyHoverListeners()\n          case 'click': return this.PRIVATE.applyClickListeners()\n          default: this.UTIL.throwError({\n            message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n          })\n        }\n      }\n    })\n  }\n\n  static get observedAttributes () {\n    return ['for', 'position', 'mode']\n  }\n\n  get annotatedElement () {\n    return this.PRIVATE.annotatedElement\n  }\n\n  get hidden () {\n    return this.PRIVATE.hidden\n  }\n\n  set hidden (bool) {\n    bool ? this.hide() : this.show()\n  }\n\n  // get position () {\n  //   return this.PRIVATE.position.join(' ')\n  // }\n  //\n  // set position (val) {\n  //\n  // }\n\n  hide () {\n    if (!this.PRIVATE.styleRules.hasOwnProperty('visibilityRule')) {\n      return\n    }\n\n    if (this.mode === 'click') {\n      document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.setStyleProperty('visibilityRule', 'display', 'none')\n    this.PRIVATE.hidden = true\n  }\n\n  show () {\n    if (this.mode === 'click') {\n      document.addEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.removeStyleProperty('visibilityRule', 'display')\n    this.PRIVATE.hidden = false\n  }\n}\n\ncustomElements.define('author-popup', AuthorPopupElement)\n\nexport default AuthorPopupElement\n"],"names":["AuthorPopupElement","UTIL","defineProperties","annotatedElement","private","readonly","get","document","getElementById","getAttribute","hidden","default","position","validPositions","validModes","defineAttributes","mode","definePrivateMethods","annotatedElementEnterHandler","evt","defaultPrevented","show","annotatedElementLeaveHandler","hide","pointerenterHandler","on","PRIVATE","off","setStyleProperty","emit","name","cfg","cancelable","pointerleaveHandler","applyHoverListeners","addEventListener","removeHoverListeners","removeEventListener","applyClickListeners","clickHandler","removeClickListeners","documentClickHandler","stopPropagation","target","contains","registerListeners","detail","attribute","oldValue","newValue","throwError","message","join","connected","insertStyleRules","positionRule","visibilityRule","styleRules","hasOwnProperty","removeStyleProperty","bool","AuthorBaseElement","HTMLElement","customElements","define"],"mappings":"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"}