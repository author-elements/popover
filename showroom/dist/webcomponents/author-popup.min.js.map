{"version":3,"file":"author-popup.min.js","sources":["../src/element.js"],"sourcesContent":["class AuthorPopupElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineProperties({\n      annotatedElement: {\n        private: true,\n        readonly: true,\n        get: () => document.getElementById(this.getAttribute('for')) || null\n      },\n\n      hidden: {\n        private: true,\n        default: true\n      },\n\n      position: {\n        private: true,\n        default: ['left', 'bottom']\n      },\n\n      validPositions: {\n        readonly: true,\n        private: true,\n        default: ['left', 'center', 'right', 'top', 'bottom']\n      },\n\n      validModes: {\n        private: true,\n        readonly: true,\n        default: ['hover', 'click', 'programmatic']\n      }\n    })\n\n    this.UTIL.defineAttributes({\n      mode: 'programmatic',\n\n      // position: {\n      //   default: 'center top',\n      //\n      //   get: () => this.PRIVATE.position ? this.PRIVATE.position.join(' ') : null,\n      //\n      //   set: value => {\n      //     if (Array.isArray(value)) {\n      //       return\n      //     }\n      //\n      //     let input = value.split(' ').map(term => {\n      //       let isValid = this.PRIVATE.validPositions.includes(term.trim())\n      //\n      //       if (!isValid) {\n      //         return this.UTIL.printToConsole(`Invalid position \"${term}\". Valid position values: \"${this.PRIVATE.validPositions.join('\", \"')}\"`, 'error')\n      //       }\n      //\n      //       return term.trim()\n      //     }).filter(Boolean)\n      //\n      //     this.PRIVATE.position = this.PRIVATE.validPositions.filter(term => input.includes(term))\n      //     this.PRIVATE.reposition()\n      //   }\n      // }\n    })\n\n    this.UTIL.definePrivateMethods({\n      annotatedElementEnterHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.show()\n      },\n\n      annotatedElementLeaveHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.hide()\n      },\n\n      pointerenterHandler: evt => {\n        this.on('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.UTIL.setStyleProperty('visibilityRule', )\n\n        this.emit({\n          name: 'annotated-element.enter',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      pointerleaveHandler: evt => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.on('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.emit({\n          name: 'annotated-element.leave',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      applyHoverListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.addEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      removeHoverListeners: () => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.removeEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      applyClickListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      removeClickListeners: () => {\n        document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      clickHandler: evt => {\n        evt.stopPropagation()\n        this.hidden ? this.show() : this.hide()\n      },\n\n      documentClickHandler: evt => {\n        if (evt.target === this || this.contains(evt.target)) {\n          return\n        }\n\n        this.hide()\n      },\n\n      // reposition: evt => {\n      //   let { annotatedElement, position } = this.PRIVATE\n      //   // let reference = this.PRIVATE.annotatedElement.getBoundingClientRect()\n      //\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //\n      //   this.UTIL.removeStyleProperties('positionRule', ['top', 'right', 'bottom', 'left', 'transform'])\n      //\n      //   switch (position[0]) {\n      //     case 'right': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetRight}px`)\n      //     case 'center': return this.UTIL.setStyleProperty('positionRule', 'left', `${(reference.left + reference.width / 2) - (this.clientWidth / 2)}`)\n      //     case 'left': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetLeft - this.clientWidth}px`)\n      //   }\n      //\n      //   // switch (position[1]) {\n      //   //   case 'top': return this.UTIL.setStyleProperty('positionRule', 'bottom', `${reference.top}px`)\n      //   //   case 'center': return this.UTIL.setStyleProperty('positionRule', 'top', `${(reference.top + reference.height / 2) - (this.clientHeight / 2)}`)\n      //   //   case 'bottom': return this.UTIL.setStyleProperty('positionRule', 'top', `${reference.bottom}px`)\n      //   // }\n      // }\n    })\n\n    this.UTIL.registerListeners(this, {\n      'attribute.change': evt => {\n        let { attribute, oldValue, newValue } = evt.detail\n\n        if (newValue === oldValue) {\n          return\n        }\n\n        switch (attribute) {\n          case 'mode':\n            this.hide()\n            this.PRIVATE.removeHoverListeners()\n            this.PRIVATE.removeClickListeners()\n\n            switch (newValue) {\n              case 'hover': return this.PRIVATE.applyHoverListeners()\n              case 'click': return this.PRIVATE.applyClickListeners()\n              default: this.UTIL.throwError({\n                message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n              })\n            }\n\n            break\n\n          // case 'position':\n          //   this.position = newValue\n          //   break\n        }\n      },\n\n      connected: () => {\n        this.UTIL.insertStyleRules({\n          positionRule: ':host {}',\n          visibilityRule: ':host {}'\n        })\n\n        this.hide()\n\n        switch (this.mode) {\n          case 'hover': return this.PRIVATE.applyHoverListeners()\n          case 'click': return this.PRIVATE.applyClickListeners()\n          default: this.UTIL.throwError({\n            message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n          })\n        }\n      }\n    })\n  }\n\n  static get observedAttributes () {\n    return ['for', 'position', 'mode']\n  }\n\n  get annotatedElement () {\n    return this.PRIVATE.annotatedElement\n  }\n\n  get hidden () {\n    return this.PRIVATE.hidden\n  }\n\n  set hidden (bool) {\n    bool ? this.hide() : this.show()\n  }\n\n  // get position () {\n  //   return this.PRIVATE.position.join(' ')\n  // }\n  //\n  // set position (val) {\n  //\n  // }\n\n  hide () {\n    if (!this.PRIVATE.styleRules.hasOwnProperty('visibilityRule')) {\n      return\n    }\n\n    if (this.mode === 'click') {\n      document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.setStyleProperty('visibilityRule', 'display', 'none')\n    this.PRIVATE.hidden = true\n  }\n\n  show () {\n    if (this.mode === 'click') {\n      document.addEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.removeStyleProperty('visibilityRule', 'display')\n    this.PRIVATE.hidden = false\n  }\n}\n\ncustomElements.define('author-popup', AuthorPopupElement)\n\nexport default AuthorPopupElement\n"],"names":["AuthorPopupElement","AuthorBaseElement","HTMLElement","[object Object]","super","this","UTIL","defineProperties","annotatedElement","private","readonly","get","document","getElementById","getAttribute","hidden","default","position","validPositions","validModes","defineAttributes","mode","definePrivateMethods","annotatedElementEnterHandler","evt","defaultPrevented","show","annotatedElementLeaveHandler","hide","pointerenterHandler","on","PRIVATE","off","setStyleProperty","emit","name","cfg","cancelable","pointerleaveHandler","applyHoverListeners","addEventListener","removeHoverListeners","removeEventListener","applyClickListeners","clickHandler","removeClickListeners","documentClickHandler","stopPropagation","target","contains","registerListeners","attribute.change","attribute","oldValue","newValue","detail","throwError","message","join","connected","insertStyleRules","positionRule","visibilityRule","observedAttributes","bool","styleRules","hasOwnProperty","removeStyleProperty","customElements","define"],"mappings":"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"}