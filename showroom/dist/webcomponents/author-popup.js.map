{"version":3,"file":"author-popup.js","sources":["../src/element.js"],"sourcesContent":["class AuthorPopupElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineProperties({\n      annotatedElement: {\n        private: true,\n        readonly: true,\n        get: () => document.getElementById(this.getAttribute('for')) || null\n      },\n\n      hidden: {\n        private: true,\n        default: true\n      },\n\n      position: {\n        private: true,\n        default: ['left', 'bottom']\n      },\n\n      validPositions: {\n        readonly: true,\n        private: true,\n        default: ['left', 'center', 'right', 'top', 'bottom']\n      },\n\n      validModes: {\n        private: true,\n        readonly: true,\n        default: ['hover', 'click', 'programmatic']\n      }\n    })\n\n    this.UTIL.defineAttributes({\n      mode: 'programmatic',\n\n      // position: {\n      //   default: 'center top',\n      //\n      //   get: () => this.PRIVATE.position ? this.PRIVATE.position.join(' ') : null,\n      //\n      //   set: value => {\n      //     if (Array.isArray(value)) {\n      //       return\n      //     }\n      //\n      //     let input = value.split(' ').map(term => {\n      //       let isValid = this.PRIVATE.validPositions.includes(term.trim())\n      //\n      //       if (!isValid) {\n      //         return this.UTIL.printToConsole(`Invalid position \"${term}\". Valid position values: \"${this.PRIVATE.validPositions.join('\", \"')}\"`, 'error')\n      //       }\n      //\n      //       return term.trim()\n      //     }).filter(Boolean)\n      //\n      //     this.PRIVATE.position = this.PRIVATE.validPositions.filter(term => input.includes(term))\n      //     this.PRIVATE.reposition()\n      //   }\n      // }\n    })\n\n    this.UTIL.definePrivateMethods({\n      annotatedElementEnterHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.show()\n      },\n\n      annotatedElementLeaveHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.hide()\n      },\n\n      pointerenterHandler: evt => {\n        this.on('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.UTIL.setStyleProperty('visibilityRule', )\n\n        this.emit({\n          name: 'annotated-element.enter',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      pointerleaveHandler: evt => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.on('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.emit({\n          name: 'annotated-element.leave',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      applyHoverListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.addEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      removeHoverListeners: () => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n          this.PRIVATE.annotatedElement.removeEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n        }\n      },\n\n      applyClickListeners: () => {\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.addEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      removeClickListeners: () => {\n        document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n\n        if (this.PRIVATE.annotatedElement) {\n          this.PRIVATE.annotatedElement.removeEventListener('click', this.PRIVATE.clickHandler)\n        }\n      },\n\n      clickHandler: evt => {\n        evt.stopPropagation()\n        this.hidden ? this.show() : this.hide()\n      },\n\n      documentClickHandler: evt => {\n        if (evt.target === this || this.contains(evt.target)) {\n          return\n        }\n\n        this.hide()\n      },\n\n      // reposition: evt => {\n      //   let { annotatedElement, position } = this.PRIVATE\n      //   // let reference = this.PRIVATE.annotatedElement.getBoundingClientRect()\n      //\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //\n      //   this.UTIL.removeStyleProperties('positionRule', ['top', 'right', 'bottom', 'left', 'transform'])\n      //\n      //   switch (position[0]) {\n      //     case 'right': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetRight}px`)\n      //     case 'center': return this.UTIL.setStyleProperty('positionRule', 'left', `${(reference.left + reference.width / 2) - (this.clientWidth / 2)}`)\n      //     case 'left': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetLeft - this.clientWidth}px`)\n      //   }\n      //\n      //   // switch (position[1]) {\n      //   //   case 'top': return this.UTIL.setStyleProperty('positionRule', 'bottom', `${reference.top}px`)\n      //   //   case 'center': return this.UTIL.setStyleProperty('positionRule', 'top', `${(reference.top + reference.height / 2) - (this.clientHeight / 2)}`)\n      //   //   case 'bottom': return this.UTIL.setStyleProperty('positionRule', 'top', `${reference.bottom}px`)\n      //   // }\n      // }\n    })\n\n    this.UTIL.registerListeners(this, {\n      'attribute.change': evt => {\n        let { attribute, oldValue, newValue } = evt.detail\n\n        if (newValue === oldValue) {\n          return\n        }\n\n        switch (attribute) {\n          case 'mode':\n            this.hide()\n            this.PRIVATE.removeHoverListeners()\n            this.PRIVATE.removeClickListeners()\n\n            switch (newValue) {\n              case 'hover': return this.PRIVATE.applyHoverListeners()\n              case 'click': return this.PRIVATE.applyClickListeners()\n              default: this.UTIL.throwError({\n                message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n              })\n            }\n\n            break\n\n          // case 'position':\n          //   this.position = newValue\n          //   break\n        }\n      },\n\n      connected: () => {\n        this.UTIL.insertStyleRules({\n          positionRule: ':host {}',\n          visibilityRule: ':host {}'\n        })\n\n        this.hide()\n\n        switch (this.mode) {\n          case 'hover': return this.PRIVATE.applyHoverListeners()\n          case 'click': return this.PRIVATE.applyClickListeners()\n          default: this.UTIL.throwError({\n            message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n          })\n        }\n      }\n    })\n  }\n\n  static get observedAttributes () {\n    return ['for', 'position', 'mode']\n  }\n\n  get annotatedElement () {\n    return this.PRIVATE.annotatedElement\n  }\n\n  get hidden () {\n    return this.PRIVATE.hidden\n  }\n\n  set hidden (bool) {\n    bool ? this.hide() : this.show()\n  }\n\n  // get position () {\n  //   return this.PRIVATE.position.join(' ')\n  // }\n  //\n  // set position (val) {\n  //\n  // }\n\n  hide () {\n    if (!this.PRIVATE.styleRules.hasOwnProperty('visibilityRule')) {\n      return\n    }\n\n    if (this.mode === 'click') {\n      document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.setStyleProperty('visibilityRule', 'display', 'none')\n    this.PRIVATE.hidden = true\n  }\n\n  show () {\n    if (this.mode === 'click') {\n      document.addEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.removeStyleProperty('visibilityRule', 'display')\n    this.PRIVATE.hidden = false\n  }\n}\n\ncustomElements.define('author-popup', AuthorPopupElement)\n\nexport default AuthorPopupElement\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;UAAA,MAAM,kBAAkB,SAAS,iBAAiB,CAAC,WAAW,CAAC,CAAC;EAChE,EAAE,WAAW,CAAC,GAAG;EACjB,IAAI,KAAK,CAAC,CAAC,yPAAmB,CAAC,EAAC;;EAEhC,IAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC;EAC/B,MAAM,gBAAgB,EAAE;EACxB,QAAQ,OAAO,EAAE,IAAI;EACrB,QAAQ,QAAQ,EAAE,IAAI;EACtB,QAAQ,GAAG,EAAE,MAAM,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI;EAC5E,OAAO;;EAEP,MAAM,MAAM,EAAE;EACd,QAAQ,OAAO,EAAE,IAAI;EACrB,QAAQ,OAAO,EAAE,IAAI;EACrB,OAAO;;EAEP,MAAM,QAAQ,EAAE;EAChB,QAAQ,OAAO,EAAE,IAAI;EACrB,QAAQ,OAAO,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;EACnC,OAAO;;EAEP,MAAM,cAAc,EAAE;EACtB,QAAQ,QAAQ,EAAE,IAAI;EACtB,QAAQ,OAAO,EAAE,IAAI;EACrB,QAAQ,OAAO,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,CAAC;EAC7D,OAAO;;EAEP,MAAM,UAAU,EAAE;EAClB,QAAQ,OAAO,EAAE,IAAI;EACrB,QAAQ,QAAQ,EAAE,IAAI;EACtB,QAAQ,OAAO,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,cAAc,CAAC;EACnD,OAAO;EACP,KAAK,EAAC;;EAEN,IAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC;EAC/B,MAAM,IAAI,EAAE,cAAc;;EAE1B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,KAAK,EAAC;;EAEN,IAAI,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC;EACnC,MAAM,4BAA4B,EAAE,GAAG,IAAI;EAC3C,QAAQ,IAAI,GAAG,CAAC,gBAAgB,EAAE;EAClC,UAAU,MAAM;EAChB,SAAS;;EAET,QAAQ,IAAI,CAAC,IAAI,GAAE;EACnB,OAAO;;EAEP,MAAM,4BAA4B,EAAE,GAAG,IAAI;EAC3C,QAAQ,IAAI,GAAG,CAAC,gBAAgB,EAAE;EAClC,UAAU,MAAM;EAChB,SAAS;;EAET,QAAQ,IAAI,CAAC,IAAI,GAAE;EACnB,OAAO;;EAEP,MAAM,mBAAmB,EAAE,GAAG,IAAI;EAClC,QAAQ,IAAI,CAAC,EAAE,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;EACrF,QAAQ,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;;EAEtF,QAAQ,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,IAAG;;EAEtD,QAAQ,IAAI,CAAC,IAAI,CAAC;EAClB,UAAU,IAAI,EAAE,yBAAyB;EACzC,UAAU,GAAG,EAAE;EACf,YAAY,UAAU,EAAE,IAAI;EAC5B,WAAW;EACX,SAAS,EAAC;EACV,OAAO;;EAEP,MAAM,mBAAmB,EAAE,GAAG,IAAI;EAClC,QAAQ,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;EACtF,QAAQ,IAAI,CAAC,EAAE,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;;EAErF,QAAQ,IAAI,CAAC,IAAI,CAAC;EAClB,UAAU,IAAI,EAAE,yBAAyB;EACzC,UAAU,GAAG,EAAE;EACf,YAAY,UAAU,EAAE,IAAI;EAC5B,WAAW;EACX,SAAS,EAAC;EACV,OAAO;;EAEP,MAAM,mBAAmB,EAAE,MAAM;EACjC,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;EAC3C,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAC;EAC1G,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAC;EAC1G,SAAS;EACT,OAAO;;EAEP,MAAM,oBAAoB,EAAE,MAAM;EAClC,QAAQ,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;EACtF,QAAQ,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,IAAI,CAAC,OAAO,CAAC,4BAA4B,EAAC;;EAEtF,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;EAC3C,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAC;EAC7G,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAC;EAC7G,SAAS;EACT,OAAO;;EAEP,MAAM,mBAAmB,EAAE,MAAM;EACjC,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;EAC3C,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,YAAY,EAAC;EAC5F,SAAS;EACT,OAAO;;EAEP,MAAM,oBAAoB,EAAE,MAAM;EAClC,QAAQ,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,oBAAoB,EAAC;;EAEhF,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;EAC3C,UAAU,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,YAAY,EAAC;EAC/F,SAAS;EACT,OAAO;;EAEP,MAAM,YAAY,EAAE,GAAG,IAAI;EAC3B,QAAQ,GAAG,CAAC,eAAe,GAAE;EAC7B,QAAQ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,IAAI,GAAE;EAC/C,OAAO;;EAEP,MAAM,oBAAoB,EAAE,GAAG,IAAI;EACnC,QAAQ,IAAI,GAAG,CAAC,MAAM,KAAK,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;EAC9D,UAAU,MAAM;EAChB,SAAS;;EAET,QAAQ,IAAI,CAAC,IAAI,GAAE;EACnB,OAAO;;EAEP;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,KAAK,EAAC;;EAEN,IAAI,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE;EACtC,MAAM,kBAAkB,EAAE,GAAG,IAAI;EACjC,QAAQ,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,GAAG,CAAC,OAAM;;EAE1D,QAAQ,IAAI,QAAQ,KAAK,QAAQ,EAAE;EACnC,UAAU,MAAM;EAChB,SAAS;;EAET,QAAQ,QAAQ,SAAS;EACzB,UAAU,KAAK,MAAM;EACrB,YAAY,IAAI,CAAC,IAAI,GAAE;EACvB,YAAY,IAAI,CAAC,OAAO,CAAC,oBAAoB,GAAE;EAC/C,YAAY,IAAI,CAAC,OAAO,CAAC,oBAAoB,GAAE;;EAE/C,YAAY,QAAQ,QAAQ;EAC5B,cAAc,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAE;EACrE,cAAc,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAE;EACrE,cAAc,SAAS,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;EAC5C,gBAAgB,OAAO,EAAE,CAAC,cAAc,EAAE,QAAQ,CAAC,iBAAiB,EAAE,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;EAC7G,eAAe,EAAC;EAChB,aAAa;;EAEb,YAAY,KAAK;;EAEjB;EACA;EACA;EACA,SAAS;EACT,OAAO;;EAEP,MAAM,SAAS,EAAE,MAAM;EACvB,QAAQ,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC;EACnC,UAAU,YAAY,EAAE,UAAU;EAClC,UAAU,cAAc,EAAE,UAAU;EACpC,SAAS,EAAC;;EAEV,QAAQ,IAAI,CAAC,IAAI,GAAE;;EAEnB,QAAQ,QAAQ,IAAI,CAAC,IAAI;EACzB,UAAU,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAE;EACjE,UAAU,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,mBAAmB,EAAE;EACjE,UAAU,SAAS,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;EACxC,YAAY,OAAO,EAAE,CAAC,cAAc,EAAE,QAAQ,CAAC,iBAAiB,EAAE,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;EACzG,WAAW,EAAC;EACZ,SAAS;EACT,OAAO;EACP,KAAK,EAAC;EACN,GAAG;;EAEH,EAAE,WAAW,kBAAkB,CAAC,GAAG;EACnC,IAAI,OAAO,CAAC,KAAK,EAAE,UAAU,EAAE,MAAM,CAAC;EACtC,GAAG;;EAEH,EAAE,IAAI,gBAAgB,CAAC,GAAG;EAC1B,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,gBAAgB;EACxC,GAAG;;EAEH,EAAE,IAAI,MAAM,CAAC,GAAG;EAChB,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM;EAC9B,GAAG;;EAEH,EAAE,IAAI,MAAM,CAAC,CAAC,IAAI,EAAE;EACpB,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,IAAI,GAAE;EACpC,GAAG;;EAEH;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,EAAE,IAAI,CAAC,GAAG;EACV,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,cAAc,CAAC,gBAAgB,CAAC,EAAE;EACnE,MAAM,MAAM;EACZ,KAAK;;EAEL,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;EAC/B,MAAM,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,oBAAoB,EAAC;EAC9E,KAAK;;EAEL,IAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,SAAS,EAAE,MAAM,EAAC;EACnE,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,KAAI;EAC9B,GAAG;;EAEH,EAAE,IAAI,CAAC,GAAG;EACV,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;EAC/B,MAAM,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,oBAAoB,EAAC;EAC3E,KAAK;;EAEL,IAAI,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,gBAAgB,EAAE,SAAS,EAAC;EAC9D,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,MAAK;EAC/B,GAAG;EACH,CAAC;;EAED,cAAc,CAAC,MAAM,CAAC,cAAc,EAAE,kBAAkB,CAAC;;;;;;;;"}