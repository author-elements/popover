{"version":3,"file":"author-popup.es5.min.js","sources":["../src/element.js"],"sourcesContent":["class AuthorPopupElement extends AuthorBaseElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.UTIL.defineProperties({\n      annotatedElement: {\n        private: true,\n        readonly: true,\n        get: () => document.getElementById(this.getAttribute('for')) || null\n      },\n\n      hidden: {\n        private: true,\n        default: true\n      },\n\n      position: {\n        private: true,\n        default: ['left', 'bottom']\n      },\n\n      validPositions: {\n        readonly: true,\n        private: true,\n        default: ['left', 'center', 'right', 'top', 'bottom']\n      },\n\n      validModes: {\n        private: true,\n        readonly: true,\n        default: ['hover', 'click', 'programmatic']\n      }\n    })\n\n    this.UTIL.defineAttributes({\n      mode: 'programmatic',\n\n      // position: {\n      //   default: 'center top',\n      //\n      //   get: () => this.PRIVATE.position ? this.PRIVATE.position.join(' ') : null,\n      //\n      //   set: value => {\n      //     if (Array.isArray(value)) {\n      //       return\n      //     }\n      //\n      //     let input = value.split(' ').map(term => {\n      //       let isValid = this.PRIVATE.validPositions.includes(term.trim())\n      //\n      //       if (!isValid) {\n      //         return this.UTIL.printToConsole(`Invalid position \"${term}\". Valid position values: \"${this.PRIVATE.validPositions.join('\", \"')}\"`, 'error')\n      //       }\n      //\n      //       return term.trim()\n      //     }).filter(Boolean)\n      //\n      //     this.PRIVATE.position = this.PRIVATE.validPositions.filter(term => input.includes(term))\n      //     this.PRIVATE.reposition()\n      //   }\n      // }\n    })\n\n    this.UTIL.definePrivateMethods({\n      annotatedElementEnterHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.show()\n      },\n\n      annotatedElementLeaveHandler: evt => {\n        if (evt.defaultPrevented) {\n          return\n        }\n\n        this.hide()\n      },\n\n      pointerenterHandler: evt => {\n        this.on('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.UTIL.setStyleProperty('visibilityRule', )\n\n        this.emit({\n          name: 'annotated-element.enter',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      pointerleaveHandler: evt => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.on('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n\n        this.emit({\n          name: 'annotated-element.leave',\n          cfg: {\n            cancelable: true\n          }\n        })\n      },\n\n      applyHoverListeners: () => {\n        this.PRIVATE.annotatedElement.addEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n        this.PRIVATE.annotatedElement.addEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n      },\n\n      removeHoverListeners: () => {\n        this.off('annotated-element.enter', this.PRIVATE.annotatedElementEnterHandler)\n        this.off('annotated-element.leave', this.PRIVATE.annotatedElementLeaveHandler)\n        this.PRIVATE.annotatedElement.removeEventListener('pointerenter', this.PRIVATE.pointerenterHandler)\n        this.PRIVATE.annotatedElement.removeEventListener('pointerleave', this.PRIVATE.pointerleaveHandler)\n      },\n\n      applyClickListeners: () => {\n        this.PRIVATE.annotatedElement.addEventListener('click', this.PRIVATE.clickHandler)\n      },\n\n      removeClickListeners: () => {\n        document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n        this.PRIVATE.annotatedElement.removeEventListener('click', this.PRIVATE.clickHandler)\n      },\n\n      clickHandler: evt => {\n        evt.stopPropagation()\n        this.hidden ? this.show() : this.hide()\n      },\n\n      documentClickHandler: evt => {\n        if (evt.target === this || this.contains(evt.target)) {\n          return\n        }\n\n        this.hide()\n      },\n\n      // reposition: evt => {\n      //   let { annotatedElement, position } = this.PRIVATE\n      //   // let reference = this.PRIVATE.annotatedElement.getBoundingClientRect()\n      //\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //   this.UTIL.setStyleProperty('positionRule', 'top', `${annotatedElement.offsetTop}px`)\n      //\n      //   this.UTIL.removeStyleProperties('positionRule', ['top', 'right', 'bottom', 'left', 'transform'])\n      //\n      //   switch (position[0]) {\n      //     case 'right': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetRight}px`)\n      //     case 'center': return this.UTIL.setStyleProperty('positionRule', 'left', `${(reference.left + reference.width / 2) - (this.clientWidth / 2)}`)\n      //     case 'left': return this.UTIL.setStyleProperty('positionRule', 'left', `${annotatedElement.offsetLeft - this.clientWidth}px`)\n      //   }\n      //\n      //   // switch (position[1]) {\n      //   //   case 'top': return this.UTIL.setStyleProperty('positionRule', 'bottom', `${reference.top}px`)\n      //   //   case 'center': return this.UTIL.setStyleProperty('positionRule', 'top', `${(reference.top + reference.height / 2) - (this.clientHeight / 2)}`)\n      //   //   case 'bottom': return this.UTIL.setStyleProperty('positionRule', 'top', `${reference.bottom}px`)\n      //   // }\n      // }\n    })\n\n    this.UTIL.registerListeners(this, {\n      'attribute.change': evt => {\n        let { attribute, oldValue, newValue } = evt.detail\n\n        if (newValue === oldValue) {\n          return\n        }\n\n        switch (attribute) {\n          case 'mode':\n            this.hide()\n            this.PRIVATE.removeHoverListeners()\n            this.PRIVATE.removeClickListeners()\n\n            switch (newValue) {\n              case 'hover': return this.PRIVATE.applyHoverListeners()\n              case 'click': return this.PRIVATE.applyClickListeners()\n              default: this.UTIL.throwError({\n                message: `Invalid mode \"${newValue}\". Valid modes: \"${this.PRIVATE.validModes.join('\", \"')}\"`\n              })\n            }\n\n            break\n\n          // case 'position':\n          //   this.position = newValue\n          //   break\n        }\n      },\n\n      connected: () => {\n        this.UTIL.insertStyleRules({\n          positionRule: ':host {}',\n          visibilityRule: ':host {}'\n        })\n\n        this.hide()\n      }\n    })\n  }\n\n  static get observedAttributes () {\n    return ['for', 'position', 'mode']\n  }\n\n  get annotatedElement () {\n    return this.PRIVATE.annotatedElement\n  }\n\n  get hidden () {\n    return this.PRIVATE.hidden\n  }\n\n  set hidden (bool) {\n    bool ? this.hide() : this.show()\n  }\n\n  // get position () {\n  //   return this.PRIVATE.position.join(' ')\n  // }\n  //\n  // set position (val) {\n  //\n  // }\n\n  hide () {\n    if (!this.PRIVATE.styleRules.hasOwnProperty('visibilityRule')) {\n      return\n    }\n\n    if (this.mode === 'click') {\n      document.removeEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.setStyleProperty('visibilityRule', 'display', 'none')\n    this.PRIVATE.hidden = true\n  }\n\n  show () {\n    if (this.mode === 'click') {\n      document.addEventListener('click', this.PRIVATE.documentClickHandler)\n    }\n\n    this.UTIL.removeStyleProperty('visibilityRule', 'display')\n    this.PRIVATE.hidden = false\n  }\n}\n\ncustomElements.define('author-popup', AuthorPopupElement)\n\nexport default AuthorPopupElement\n"],"names":["AuthorPopupElement","UTIL","defineProperties","annotatedElement","private","readonly","get","document","getElementById","_this","getAttribute","hidden","default","position","validPositions","validModes","defineAttributes","mode","definePrivateMethods","annotatedElementEnterHandler","evt","defaultPrevented","show","annotatedElementLeaveHandler","hide","pointerenterHandler","on","PRIVATE","off","setStyleProperty","emit","name","cfg","cancelable","pointerleaveHandler","applyHoverListeners","addEventListener","removeHoverListeners","removeEventListener","applyClickListeners","clickHandler","removeClickListeners","documentClickHandler","stopPropagation","target","contains","registerListeners","detail","attribute","oldValue","newValue","throwError","message","join","connected","insertStyleRules","positionRule","visibilityRule","AuthorBaseElement","HTMLElement","this","styleRules","hasOwnProperty","removeStyleProperty","bool","customElements","define"],"mappings":"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"}